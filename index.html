<!DOCTYPE html>
<html>
    <head>
        <title>Portfolio</title>
        <link rel="stylesheet" type="text/css" href="./styles/style.css" />
        <link rel="stylesheet" type="text/css" href="./fonts/fontawesome-free-5.14.0-web/css/all.css" />
    </head>
    <body>
        <header id="pageHeader">
            <div id="navBar">
                <div id="navBarBg">
                    <!-- <div class="defaultBg"></div>
                    <div class="border"></div> -->
                </div>
                <div id=navBarContent>
                    <h3>Portfolio</h3>
                    <nav>
                        <a><i class="fab fa-github fa-2x"></i></a>
                        <a><i class="fab fa-linkedin fa-2x"></i></a>
                    </nav>
                </div>
            </div>
            <div id="headerBg">
                <div class="bgLayer bgLayer1"></div>
                <div class="bgLayer bgLayer2"></div>
            </div>
            <div id="headerContent">
                <h1>Projects</h1>
            </div>
            <a href="#pageFooter"><i id="headerArrowDown" class="fas fa-arrow-down fa-2x"></i></a>
        </header>
        <section id="projectSection">
            <div id="projectTable" class="sectionContent">
                <div id="item-1" class="tableItem">
                    <div class="titleBar" onclick="openItem('itemOpenIcon-1', 'item-1', 'itemContent-1', 0)">
                        <h2>Project 1</h2>
                        <i id="itemOpenIcon-1" class="fas fa-caret-down fa-2x itemOpenIcon"></i>
                    </div>
                    <div id="itemContent-1" class="itemContent">
                        <div id="itemImage-1" class="itemImage" 
                            style="background-image: url('./images/butterfly-2049567_1920.jpg')" 
                            onClick="showLargeImg('itemImage-1')"></div>
                        <p class="itemText">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit. 
                            Excepturi voluptatibus illo odio non expedita nisi consequatur quod incidunt odit? 
                            Tempora et cum ullam esse ut dolores consequatur eum natus velit saepe. 
                            Possimus eum veritatis officia temporibus commodi dicta ullam facere aliquam similique quia, 
                            dolor modi ratione blanditiis quibusdam rem eius?
                        </p>
                        <span class="buttons">
                            <button>App</button>
                            <button>Code</button>
                        </span>
                    </div>
                </div>
                <div id="item-2" class="tableItem">
                    <div class="titleBar" onclick="openItem('itemOpenIcon-2', 'item-2', 'itemContent-2', 0)">
                        <h2>Project 2</h2>
                        <i id="itemOpenIcon-2" class="fas fa-caret-down fa-2x itemOpenIcon"></i>
                    </div>
                    <div id="itemContent-2" class="itemContent">
                        <div id="itemImage-2" class="itemImage" 
                            style="background-image: url('./images/away-4059472_1920.jpg')" 
                            onClick="showLargeImg('itemImage-2')"></div>
                        <p class="itemText">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit. 
                            Excepturi voluptatibus illo odio non expedita nisi consequatur quod incidunt odit? 
                            Tempora et cum ullam esse ut dolores consequatur eum natus velit saepe. 
                            Possimus eum veritatis officia temporibus commodi dicta ullam facere aliquam similique quia, 
                            dolor modi ratione blanditiis quibusdam rem eius?
                        </p>
                        <span class="buttons">
                            <button>App</button>
                            <button>Code</button>
                        </span>
                    </div>
                </div>
                <!-- <div class="tableItem">
                    <h2 class="itemTitle">Project 1</h2>
                    <img class="itemImage" src="./images/butterfly-2049567_1920.jpg"></img>
                    <p class="itemText">Lorem ipsum dolor sit amet consectetur adipisicing elit. 
                        Eos porro eveniet nostrum possimus nobis placeat vitae animi quisquam vero harum eum quidem nihil, 
                        odit ut quo doloremque amet. Accusantium, deserunt! Ipsam, est. Accusantium provident, non, 
                        impedit ut recusandae eos in sit aliquam tempora ratione veritatis vitae asperiores deleniti 
                        fugiat repellat.</p>
                        <span class="buttons">
                            <button>App</button>
                            <button>Code</button>
                        </span>
                </div>
                <div class="tableItem">
                    <h2 class="itemTitle">Project 2</h2>
                    <img class="itemImage" src="./images/butterfly-2049567_1920.jpg"></img>
                    <p class="itemText">Lorem ipsum dolor sit amet consectetur adipisicing elit. 
                        Eos porro eveniet nostrum possimus nobis placeat vitae animi quisquam vero harum eum quidem nihil, 
                        odit ut quo doloremque amet. Accusantium, deserunt! Ipsam, est. Accusantium provident, non, 
                        impedit ut recusandae eos in sit aliquam tempora ratione veritatis vitae asperiores deleniti 
                        fugiat repellat.</p>
                        <span class="buttons">
                            <button>App</button>
                            <button>Code</button>
                        </span>
                </div>
                <div class="tableItem">
                    <h2 class="itemTitle">Project 3</h2>
                    <img class="itemImage" src="./images/butterfly-2049567_1920.jpg"></img>
                    <p class="itemText">Lorem ipsum dolor sit amet consectetur adipisicing elit. 
                        Eos porro eveniet nostrum possimus nobis placeat vitae animi quisquam vero harum eum quidem nihil, 
                        odit ut quo doloremque amet. Accusantium, deserunt! Ipsam, est. Accusantium provident, non, 
                        impedit ut recusandae eos in sit aliquam tempora ratione veritatis vitae asperiores deleniti 
                        fugiat repellat.</p>
                        <span class="buttons">
                            <button>App</button>
                            <button>Code</button>
                        </span>
                </div> -->
            </div>
        </section>
        <footer id="pageFooter">
            <a href="#pageHeader"><i id="footerArrowUp" class="fas fa-arrow-up fa-2x"></i></a>
            <div id="footerBg">
                <div class="bgLayer bgLayer1"></div>
                <div class="bgLayer bgLayer2"></div>
            </div>
            <div id="footerContent">
                <h1>The End</h1>
            </div>
            <div id="footerBar">
                <div id="footerBarBg"></div>
                <div id="footerBarContent">
                    <div>Sami Aartolahti</div>
                    <div>September 4th 2020</div>
                </div>
            </div>
        </footer>
        <div id="imagePanel" onclick="hideLargeImg()">
            <button id="imagePanelButton" onclick="hideLargeImg()">X</button>
            <img id="imagePanelImg" src="" />
        </div>
    </body>
    <script>
        const navBarBg = document.getElementById("navBarBg");
        const pageFooter = document.getElementById("pageFooter");
        const footerBarBg = document.getElementById("footerBarBg");
        const projectTable = document.getElementById("projectTable");
        const tableItemsList = document.getElementsByClassName("tableItem");
        const iconsList = document.getElementsByClassName("itemOpenIcon");
        let itemHeightsList;
        let  titleBarHeight;
        let pageFooterOffset;
        let navBarHasAngle;
        let footerHasAngle;
        let rad;
        let deg;

        // Find out the right angle for the navBarBg and footerBarBg
        // let rad = (Math.atan((innerHeight * 0.78) / innerWidth));
        // let deg = rad * (180 / Math.PI);

        // Initialize the navBarBg
        // navBarBg.style.transform = "skewY(" + 0 + "deg) translateY(-90%)";
        // navBarHasAngle = true;
        // footerHasAngle = true;
        // skewNavBarAnimation();
        // skewFooterBarAnimation();
        // navBarBg.style.transform = "skewY(" + (-deg) + "deg) translateY(-90%)";
        // footerBarBg.style.transform = "skewY(" + (-deg) + "deg)";
        initializePage();

        onresize = function() {
            // initializePage();
            location.reload();
        };

        // Start or stop playing animations depending on how much the page has been scrolled
        onscroll = function() {
            // Update pageFooterOffset for skewFooterBarAnimation function,
            // because its offset value changes when project content is opened or closed
            skewHeaderAndFooter();

            // if (document.documentElement.scrollTop >= projectTable.offsetTop - innerHeight &&
            //     document.documentElement.scrollTop <= projectTable.offsetTop + 
            //     Number.parseFloat(getComputedStyle(projectTable).height)) {
            //     moveItemsToScreen(document.documentElement.scrollTop);
            // }

            moveItemsToScreen(document.documentElement.scrollTop);

        };

        function initializePage() {
            // const titleBarHeight = Number.parseFloat(getComputedStyle(document.getElementsByClassName("titleBar")[0]).height);
            const wait = setInterval(() => { // wait until the document is loaded to avoid wrong values from getComputedStyle function
                let itemContentHeight;
                pageFooterOffset = pageFooter.offsetTop - innerHeight * 0.05;
                navBarHasAngle = true;
                footerHasAngle = true;
                rad = (Math.atan((innerHeight * 0.78) / innerWidth));
                deg = rad * (180 / Math.PI);
                navBarBg.style.transform = "skewY(" + (-deg) + "deg) translateY(-90%)";
                footerBarBg.style.transform = "skewY(" + (-deg) + "deg)";
                // skewHeaderAndFooter();

                // icon.style.transform = "rotate(180deg)";
                // tableItemsList = document.getElementsByClassName("tableItem");
                itemHeightsList = [];
                titleBarHeight = Number.parseFloat(getComputedStyle(document.getElementsByClassName("titleBar")[0]).height);
                // projectTable.style.height = (titleBarHeight * 4) + "px";

                for (let i = 0; i < tableItemsList.length; i++) {
                    // itemContentHeight = Number.parseFloat(getComputedStyle(document.getElementsByClassName("itemContent")[i]).height);
                    // openItem(`itemOpenIcon-${i + 1}`, `item-${i + 1}`, `itemContent-${i}`, i);
                    // tableItemsList[i].style.height = "100%";
                    itemHeightsList[i] = Number.parseFloat(getComputedStyle(tableItemsList[i]).height);
                    // itemHeightsList[i] = tableItemsList[i].getBoundingClientRect().height;
                    // itemHeightsList[i] = titleBarHeight + itemContentHeight;
                    // itemHeightsList[i] = (0.78 * innerHeight);
                    tableItemsList[i].style.height = titleBarHeight + "px";
                    iconsList[i].style.transform = "";
                }

                // for (let i = 0; i < tableItemsList.length; i++) {
                //     openItem(`itemOpenIcon-${i + 1}`, `item-${i + 1}`, `itemContent-${i + 1}`, i);
                // }

                // console.log(Number.parseFloat(tableItemsList[0].style.height) + ", " + itemHeightsList[0] + ", " + titleBarHeight);

                clearInterval(wait);
            }, 250);
        }

        function skewHeaderAndFooter() {
            pageFooterOffset = pageFooter.offsetTop - innerHeight * 0.05;

            if (document.documentElement.scrollTop <= innerHeight / 2 && navBarHasAngle === false) {
                navBarHasAngle = true;
                navBarBg.style.transform = "skewY(" + (-deg) + "deg) translateY(-90%)";
            } else if (document.documentElement.scrollTop > innerHeight && navBarHasAngle === true) {
                navBarHasAngle = false;
                navBarBg.style.transform = "skewY(" + 0 + "deg) translateY(-90%)";
            } else if (document.documentElement.scrollTop >= pageFooterOffset - innerHeight / 2 && footerHasAngle === false) {
                footerHasAngle = true;
                footerBarBg.style.transform = "skewY(" + (-deg) + "deg)";
            } else if (document.documentElement.scrollTop < pageFooterOffset - innerHeight && footerHasAngle === true) {
                footerHasAngle = false;
                footerBarBg.style.transform = "skewY(" + 0 + "deg)";
            }
        }

        // Function which starts and stops the skew animation of navBarBg element
        // function skewNavBarAnimation() {
        //     let newDeg = 0;
        //     let change = rad;

        //     const skewNavBarInterval = setInterval(() => {
        //         if (newDeg >= deg) {
        //             clearInterval(skewNavBarInterval);
        //         } else if (navBarHasAngle === false) {
        //             navBarBg.style.transform = "skewY(" + 0 + "deg) translateY(-90%)";
        //             clearInterval(skewNavBarInterval);
        //         } else {
        //             change = change * 0.983;
        //             newDeg = newDeg + change;
        //             navBarBg.style.transform = "skewY(" + (-newDeg) + "deg) translateY(-90%)";
        //         }
        //     }, 15);

        //     navBarBg.style.transform = "skewY(" + (-deg) + "deg) translateY(-90%)";
        // }

        // Function which starts and stops the skew animation of footerBarBg element
        // function skewFooterBarAnimation() {
        //     let newDeg = 0;
        //     let change = rad;

        //     const skewFooterBarInterval = setInterval(() => {
        //         if (newDeg >= deg) {
        //             clearInterval(skewFooterBarInterval);
        //         } else if (footerHasAngle === false) {
        //             footerBarBg.style.transform = "skewY(" + 0 + "deg)";
        //             clearInterval(skewFooterBarInterval);
        //         } else {
        //             change = change * 0.983;
        //             newDeg = newDeg + change;
        //             footerBarBg.style.transform = "skewY(" + (-newDeg) + "deg)";
        //         }
        //     }, 15);

        //     footerBarBg.style.transform = "skewY(" + (-deg) + "deg)";
        // }

        // Function for moving a project item into the view
        function moveItemsToScreen(scrollPos) {
            const itemMinHeight = titleBarHeight;
            let itemHeight;

            for (let i = 0; i < tableItemsList.length; i++) {
                itemHeight = Number.parseFloat(getComputedStyle(tableItemsList[i]).height); // Current height of the item

                if (tableItemsList[i].style.left === "-100vw" && 
                    scrollPos >= tableItemsList[i].offsetTop - innerHeight + itemHeight / 2 &&
                    scrollPos <= tableItemsList[i].offsetTop + itemHeight / 2) {
                    tableItemsList[i].style.left = "0";
                } else if (Number.parseInt(itemHeight) === Number.parseInt(itemMinHeight) && 
                    getComputedStyle(tableItemsList[i]).left === "0px" && 
                    (scrollPos < tableItemsList[i].offsetTop - innerHeight + itemHeight / 2 ||
                    scrollPos > tableItemsList[i].offsetTop + itemHeight / 2)) {
                    tableItemsList[i].style.left = "-100vw";
                }
            }
        }

        // Function for showing or hiding the project content
        function openItem(iconId, itemId, itemContentId, index) {
            const item = document.getElementById(itemId);
            const icon = document.getElementById(iconId);
            // const itemContent = document.getElementById(itemContentId);
            // let titleBarHeight = getComputedStyle(document.getElementsByClassName("titleBar")[0]).height;
            let finalHeight = itemHeightsList[index];
            // let change = 2;

            if (icon.style.transform !==  "rotate(180deg)") {
                icon.style.transform = "rotate(180deg)";
            } else { // Close item
                icon.style.transform = "";
                // itemHeight = finalHeight;
                finalHeight = titleBarHeight;
                // change = -change;

                // Move all project items into the view because otherwise some items 
                // which should be in the view after closing this item,
                // does not move to the view without scrolling
                for (let i = 0; i < tableItemsList.length; i++) {
                    tableItemsList[i].style.left = "0";
                }
                // console.log(document.documentElement.scrollTop + ", " + (document.documentElement.scrollTop + Number.parseFloat(getComputedStyle(item).height) + Number.parseFloat(titleBarHeight)));
            }

            item.style.height = finalHeight + "px";

            // console.log(titleBarHeight + ", " + finalHeight);

            // const animateItemContent = setInterval(() => {
            //     change = change * 0.95;
            //     itemHeight = itemHeight + change;
            //     item.style.height = itemHeight + "vh";

            //     if ((finalHeight > 10 && itemHeight >= finalHeight * 0.95) || (finalHeight === 10 && itemHeight <= finalHeight * 1.05)) {
            //         clearInterval(animateItemContent);
            //     }
            // }, 15);
        }

        function showLargeImg(imgId) {
            const img = document.getElementById(imgId);
            const imgUrlStr = getComputedStyle(img).backgroundImage;
            const imagePanel = document.getElementById("imagePanel");
            const imagePanelImg = document.getElementById("imagePanelImg");
            let percentage = 0.1;

            imagePanelImg.src = `${imgUrlStr.substr(13, imgUrlStr.length - 15)}`; // Remove first four ('url(') letters and last (')') letter
            imagePanel.style.display = "flex";

            const largenImg = setInterval(() => {
                // percentage *= 2;
                // if (percentage <= 80) {
                //     imagePanelImg.style.width = `${percentage}%`;
                //     imagePanel.style.backgroundColor = `rgba(46, 39, 53, ${percentage / 100})`;
                // }
                // else {
                    imagePanelImg.style.width = "80%";
                    imagePanel.style.backgroundColor = "var(--text-color-dark-transparent)";
                    clearInterval(largenImg);
                // }
            }, 10);
        }

        function hideLargeImg() {
            // document.getElementById('imagePanel').style.display = 'none'
            const imagePanel = document.getElementById("imagePanel");
            const imagePanelImg = document.getElementById("imagePanelImg");
            
            imagePanelImg.style.width = "0%";
            imagePanel.style.backgroundColor = "transparent";
            imagePanel.style.display = "none";
        }
    </script>
</html>